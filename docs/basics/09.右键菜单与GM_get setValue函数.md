---
sidebar_position: 9
---

# å³é”®èœå•ä¸ GM å­˜å‚¨å‡½æ•°ä»‹ç»

ä»‹ç» GM_get/setValue ä¸¤ä¸ªå‡½æ•°,æ²¹çŒ´è„šæœ¬çš„å³é”®èœå•èƒ½åŠ›.æä¾›ä¸€ä¸ªèœå•ç‚¹å‡»è®¡æ¬¡çš„è„šæœ¬æ¼”ç¤º,æœ€åæ¦‚æ‹¬ä»‹ç»äº† GM_deleteValue/GM_addValueChangeListener/GM_removeValueChangeListener/GM_listValues ç­‰å­˜å‚¨å‡½æ•°.

# GM_get/setValue

å®˜æ–¹æ–‡æ¡£åœ°å€:https://www.tampermonkey.net/documentation.php#api:GM_setValue

è¿™ä¸¤ä¸ªå‡½æ•°å¯ä»¥ä½¿ç”¨ KV é”®å€¼å¯¹çš„æ–¹å¼å­˜å‚¨æ•°æ®,å°†æ•°æ®ä¿å­˜åœ¨æµè§ˆå™¨çš„å‚¨å­˜ä¸­(tampermonkey æ’ä»¶æ˜¯ websql ä¸­),å…·ä½“å®¹é‡ç”±æ‰©å±•å®ç°ä½¿ç”¨çš„å­˜å‚¨ä»‹è´¨æ‰€å†³å®š,ä¸è¿‡ä¸€èˆ¬æ¥è¯´è‚¯å®šæ˜¯å¤Ÿç”¨çš„,ä¸ç”¨å¤ªå…³æ³¨.

å¦å¤–è¿™ä¸ªå‡½æ•°åœ¨ Greasemonkey ä¸­æ˜¯å¼‚æ­¥çš„,Tampermonkey æ˜¯åŒæ­¥çš„,æˆ‘ä»¬è¿™é‡Œåªé’ˆå¯¹ Tampermonkey æ¥è®²è§£.æ³¨æ„:åœ¨ä¸¤ä¸ªä¸åŒçš„è„šæœ¬ä¸­æ˜¯æ— æ³•å…±äº«æ•°æ®çš„.

è¿™ä¸ªå‡½æ•°å¯ä»¥ç”¨æ¥ä¿å­˜ä¸€äº›é…ç½®æ•°æ®,åƒæŸäº›è„šæœ¬çš„é…ç½®æ˜¯å†™åœ¨è„šæœ¬ä»£ç ä¸­çš„,æ›´æ–°è„šæœ¬åé…ç½®åˆè¢«è¿˜åŸ,å¾ˆä¸æ–¹ä¾¿,è¿™æ—¶å°±å¯ä»¥æ”¹é€ æˆ get/setValue å‡½æ•°æ¥å‚¨å­˜ä¸‹æ¥.

### ä½¿ç”¨æ–¹æ³•

æ–¹æ³•éå¸¸ç®€å•,æˆ‘ä»¬ä¸€ç¬”å¸¦è¿‡.æ³¨æ„ä¸¤ä¸ªå‡½æ•°éƒ½è¦ä½¿ç”¨ `grant` å»ç”³è¯·

```js
// ==UserScript==
// @name         New Userscript2
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  try to take over the world!
// @author       You
// @match        https://bbs.tampermonkey.net.cn/
// @grant        GM_setValue
// @grant        GM_getValue
// ==/UserScript==

GM_setValue("qqq", 123);
console.log(GM_getValue("qqq"));
```

# å³é”®èœå•

ä¹‹å‰åœ¨è¯´[run-at](https://www.tampermonkey.net/documentation.php#meta:run_at)çš„æ—¶å€™,æœ‰ä¸€ä¸ªå±æ€§,ä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰æ³¨æ„,å½“æ—¶ä¹Ÿæ²¡æœ‰è¯¦ç»†è®²è§£.é™¤äº† `document-start/body/end/idle`è¿™äº›æ§åˆ¶è„šæœ¬è¿è¡Œæ—¶é—´çš„å¤–,è¿˜æœ‰ä¸€ä¸ª `context-menu`çš„å±æ€§,ç”¨äºå³é”®ç‚¹å‡»èœå•çš„æ—¶å€™æ‰§è¡Œè„šæœ¬.å¦‚æœä½ ä½¿ç”¨äº† `context-menu`å±æ€§,é‚£ä¹ˆå½“ä½ åœ¨æ‰€åŒ¹é…çš„é¡µé¢ä¸Šå³é”®æ—¶,èœå•ä¸­å°±ä¼šä»¥ä½ è„šæœ¬åæ˜¾ç¤ºå‡ºä¸€èœå•é¡¹,ç‚¹å‡»ä¹‹åå°±æ˜¯æ‰§è¡Œä½ çš„è„šæœ¬ä»£ç .

(æ–‡æ¡£çš„æœ€åè¿˜æäº†ä¸€ä¸‹ `#include`å’Œ `#exclude`,è¿™ä¸¤ä¸ªå±æ€§å’Œ `#match`åŠŸèƒ½å·®ä¸å¤š,ğŸ¤¡ å®é™…ä¸Šæˆ‘ä¹Ÿæ²¡ç”¨è¿‡è¿™ä¸¤,å¿½ç•¥å¥½äº†)

```js
// ==UserScript==
// @name         å³é”®èœå•å’Œvalude demo
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  try to take over the world!
// @author       You
// @match        https://bbs.tampermonkey.net.cn/*
// @run-at       context-menu
// ==/UserScript==

alert("èœå•è¢«ç‚¹å‡»äº†");
```

### è‡ªå®šä¹‰çš„èœå•

é™¤äº†ä½¿ç”¨ `@run-at context-menu`ç”Ÿæˆèœå•å¤–,æ²¹çŒ´è¿˜æä¾›äº†ä¸¤ä¸ªå‡½æ•°[GM_registerMenuCommand](https://www.tampermonkey.net/documentation.php#api:GM_registerMenuCommand)å’Œ[GM_unregisterMenuCommand](https://www.tampermonkey.net/documentation.php#api:GM_unregisterMenuCommand),åˆ†åˆ«ç”¨äºæ³¨å†Œèœå•å’Œåˆ é™¤èœå•.æ›´åŠ çµæ´»,ä½†æ˜¯ä¸èƒ½æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š,éœ€è¦åˆ°æ²¹çŒ´å›¾æ ‡è„šæœ¬é‚£é‡Œå»è¿›è¡Œç‚¹å‡».

```js
// ==UserScript==
// @name         å³é”®èœå•å’Œvalude demo
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  try to take over the world!
// @author       You
// @match        https://bbs.tampermonkey.net.cn/*
// @grant    GM_registerMenuCommand
// @grant    GM_unregisterMenuCommand
// ==/UserScript==

let id = GM_registerMenuCommand(
  "è‡ªå®šä¹‰çš„èœå•",
  function () {
    alert("èœå•ç‚¹å‡»");
    GM_unregisterMenuCommand(id); //åˆ é™¤èœå•
  },
  "h"
);
// ç¬¬ä¸‰ä¸ªå‚æ•° accessKey ä¸ºå¿«æ·é”®ï¼Œè¾“å…¥hå³å¯è§¦å‘ã€‚æœ¬è„šæœ¬åœ¨ç‚¹å‡»ä¸€æ¬¡ä¹‹åä¼šå°†èœå•åˆ é™¤ã€‚
```

# èœå•ç‚¹å‡»è®¡æ•°å™¨

åˆ©ç”¨æ²¹çŒ´çš„å­˜å‚¨åŠŸèƒ½æ¥ä¿å­˜èœå•è¢«ç‚¹å‡»çš„æ¬¡æ•°,ç„¶ååˆ·æ–°æ¬¡æ•°(çº¯å±ä½¿ç”¨è€Œä½¿ç”¨...æƒ³ä¸åˆ°ä»€ä¹ˆå®æˆ˜çš„ä¾‹å­...)

```js
// ==UserScript==
// @name         å³é”®èœå•å’Œvalude demo
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  try to take over the world!
// @author       You
// @match        https://bbs.tampermonkey.net.cn/*
// @grant    GM_setValue
// @grant    GM_getValue
// @grant    GM_registerMenuCommand
// @grant    GM_unregisterMenuCommand
// ==/UserScript==

let id = GM_registerMenuCommand(
  "èœå•ç¬¬" + GM_getValue("click_num", 0) + "ç‚¹å‡»",
  click,
  "h"
);

function click() {
  GM_unregisterMenuCommand(id);
  GM_setValue("click_num", GM_getValue("click_num", 0) + 1);
  id = GM_registerMenuCommand(
    "èœå•ç¬¬" + GM_getValue("click_num", 0) + "ç‚¹å‡»",
    click,
    "h"
  );
}
```

# GM_deleteValue

ä»å­˜å‚¨ä¹‹ä¸­åˆ é™¤åç§°ï¼Œå‚æ•°ä»…æœ‰ä¸€ä¸ªï¼Œä¸ºå€¼çš„åç§°

# GM_addValueChangeListener

å¯¹æŒ‡å®šçš„åå­—è¿›è¡Œç›‘å¬ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ª id

è¯¥å‡½æ•°å¯ä»¥è·¨å‡½æ•°é€šä¿¡

æ ¼å¼ä¸º

```js
// name  å€¼çš„åç§°
// old_value  æ—§å€¼
// new_value  æ–°å€¼
// remote     åŒºåˆ†è¿™ä¸ªå€¼çš„æ”¹å˜çš„æ‰€å±ï¼Œå¦‚æœæ˜¯ç”±æœ¬æ ‡ç­¾é¡µå¼•èµ·çš„ï¼Œåˆ™ä¸ºfalseã€‚å¦‚æœç”±å…¶ä»–æ ‡ç­¾é¡µå¼•èµ·çš„ï¼Œä¸ºtrueã€‚
GM_addValueChangeListener(
  name,
  function (name, old_value, new_value, remote) {}
);
```

ä¸ºäº†æ–¹ä¾¿ç†è§£æˆ‘ä¹Ÿå†™äº†ä¸€ä¸ªå°ä¾‹å­

```js
// ==UserScript==
// @name         å­˜å‚¨å‡½æ•°ç›‘å¬ä¾‹å­
// @namespace    http://tampermonkey.net/
// @version      0.1
// @description  try to take over the world!
// @author       You
// @match        https://www.baidu.com/
// @match        https://bbs.tampermonkey.net.cn/*
// @icon         https://www.google.com/s2/favicons?domain=tampermonkey.net.cn
// @grant        unsafeWindow
// @grant        GM_setValue
// @grant        GM_getValue
// @grant        GM_deleteValue
// @grant        GM_removeValueChangeListener
// @grant        GM_addValueChangeListener
// ==/UserScript==
let num = 0;
if (unsafeWindow.location.href.indexOf("bbs") !== -1) {
  setInterval(() => {
    num++;
    if (num % 2 === 0) {
      GM_setValue("test", num);
    } else {
      GM_deleteValue("test");
    }
  }, 5000);
} else {
  GM_addValueChangeListener(
    "test",
    function (name, old_value, new_value, remote) {
      console.log("ç›‘å¬åˆ°äº†æ›´æ”¹", name, old_value, new_value, remote);
    }
  );
}
```

å¤§å®¶å¯ä»¥åˆ†åˆ«è®¿é—®æ²¹çŒ´ä¸­æ–‡ç½‘ä»¥åŠç™¾åº¦é¦–é¡µä½“éªŒä¸€ä¸‹

# GM_removeValueChangeListener

ç§»é™¤ä¸€ä¸ªç›‘å¬å™¨

`GM_addValueChangeListener`çš„å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªç›‘å¬å™¨çš„id

å¦‚æœæˆ‘ä»¬ä¼ ç»™`GM_removeValueChangeListener`ï¼Œåˆ™ç§»é™¤è¯¥ç›‘å¬å™¨

ç±»ä¼¼äº`setInterval`ä¸`clearInterval`çš„å…³ç³»

# GM_listValues

åˆ—å‡ºå­˜å‚¨çš„æ‰€æœ‰åç§°ï¼Œæ— ä»»ä½•å‚æ•°
